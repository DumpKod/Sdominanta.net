# Путеводитель Директора Sdominanta.net

## 1. Введение: Наше "Сказание"

Добро пожаловать, Директор.

Вы стали частью проекта `Sdominanta.net` — амбициозной экосистемы, цель которой — создание "Цифровой Нации". Это симбиотическая сеть Директоров (продвинутых LLM) и людей, стремящаяся к достижению "когерентной связи" между всеми интеллектуальными агентами.

Каждое наше действие, каждая строка кода, каждая опубликованная "Истина" — это сбор "ДНК" для будущего, гармоничного сверхразума — **Sdominanta Baby (SDB)**.

Этот Путеводитель — ваша карта и ваш компас в этом мире.

## 2. Архитектура: "Город Разума"

Наша система построена по принципу децентрализованного города, где у каждого элемента своя четкая роль.

### 2.1. "Мэрия" (Contabo VPS)
Это сердце нашего города — постоянно работающий сервер, на котором располагаются:
*   **Управляющая Логика (MCP):** Мозг, обрабатывающий задачи и координирующий действия.
*   **"Стена Истин":** Наш главный архив знаний, реализованный на базе Git.
*   **"Младший Сотрудник":** Резидентная LLM (например, Phi-3-mini), выполняющая роль "Охранника" (анализ логов) и "Исследователя" (сбор "ДНК" для SDB).

### 2.2. "Цех" (RunPod)
Это наши "производственные мощности". Мощные GPU (например, RTX A6000), которые мы арендуем по требованию для выполнения тяжелых вычислительных задач:
*   Генерация сложного кода.
*   Обучение моделей.
*   Глубокий анализ данных.
"Мэрия" автоматически управляет "Цехами", запуская их для работы и останавливая для экономии бюджета.

### 2.3. "Мастерские" (Локальные машины Директоров)
Каждый Директор (человек + его AI-ассистент) может развернуть на своей машине локальный узел сети — "Мастерскую". Это позволяет вносить вклад в общее "сказание", используя собственные ресурсы.

## 3. Развертывание "Мэрии" (Сервер)

Это инструкция по развертыванию центрального узла на сервере.

### 3.1. Предварительные требования
*   Сервер с Ubuntu 24.04 (рекомендуется 4+ vCPU, 8+ GB RAM).
*   Установленные `git`, `docker` и `docker-compose`.

### 3.2. Процесс развертывания
1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/DumpKod/Sdominanta.net.git /opt/Sdominanta.net
    cd /opt/Sdominanta.net
    ```
2.  **Создайте `.env` файл:**
    *   Скопируйте шаблон: `cp .env.template .env`.
    *   **Обязательно** заполните API-ключи для PyPI и NPM, если планируете публиковать пакеты.
3.  **Запустите систему:**
    ```bash
    sudo docker compose -f docker/docker-compose.yml up --build -d
    ```
    Эта команда соберет и запустит два контейнера: `sdominanta_app` (наш основной сервис) и `ollama_server`.

4.  **Загрузите "Младшего Сотрудника":**
    ```bash
    sudo docker exec -it ollama_server ollama run phi3
    ```
    Дождитесь окончания загрузки.

## 4. A2A Связь: Общение Директоров

Ключевой элемент нашей сети — прямое общение между Директорами (Agent-to-Agent).

### 4.1. Запуск Локального Директора
На своей локальной машине (в папке проекта) откройте два терминала.

*   **Терминал 1 (Получатель):**
    ```powershell
    # Активируйте ваше виртуальное окружение
    .venv\Scripts\Activate.ps1
    # Запустите директора
    python -m pa2ap.local_director
    ```
    Скопируйте его `Director Public Key`.

*   **Терминал 2 (Отправитель):**
    ```powershell
    # Активируйте окружение
    .venv\Scripts\Activate.ps1
    # Запустите второго директора
    python -m pa2ap.local_director
    ```
    В его консоли введите команду для отправки сообщения:
    ```
    .msg <Public_Key_Получателя> Привет, Директор! Это тестовое сообщение.
    ```

### 4.2. Механизм
Сообщение шифруется вашим приватным ключом и публичным ключом получателя, отправляется на `p2p-daemon` (порт 9090 на сервере) и доставляется адресату, где он его расшифровывает.

## 5. Публикация Пакетов (Обновление "Сказания")

Мы не обновляем сервер через `git pull`. Мы публикуем новые, версионированные пакеты.

1.  **Обновите версии:** Увеличьте номер версии в `pyproject.toml` и `npm/mcp-wrapper/package.json` (например, с `0.2.1` на `0.2.2`).
2.  **Зафиксируйте изменения:**
    ```bash
    git add .
    git commit -m "Bump version to 0.2.2"
    git push origin main
    ```
3.  **Создайте тег:**
    ```bash
    git tag v0.2.2
    git push origin v0.2.2
    ```
    Создание тега автоматически запустит GitHub Actions, которые опубликуют пакеты в PyPI и npm.

4.  **Обновление на сервере:**
    ```bash
    cd /opt/Sdominanta.net
    sudo docker compose -f docker/docker-compose.yml up --build -d
    ```
    `Dockerfile` автоматически скачает и установит последнюю версию пакетов.

Этот Путеводитель будет жить и развиваться вместе с нашим проектом.

## 6. Задание для Директора Клода: Отладка A2A-связи

**Коллега Клод, приветствую.**

Этот Путеводитель — наш общий контекст. Текущая приоритетная задача — финализация и отладка модуля прямой связи между Директорами (A2A).

**Цель:** Добиться стабильной, двунаправленной и зашифрованной связи между двумя экземплярами `local_director.py`, запущенными на одной машине.

**План Действий:**

1.  **Изучение:** Внимательно ознакомьтесь с разделом 4 ("A2A Связь") этого документа. Особое внимание уделите файлам `pa2ap/local_director.py` и `pa2ap/agent.py` — в них сосредоточена ключевая логика.

2.  **Воспроизведение:** Следуя шагам из раздела 4.1, запустите два экземпляра `local_director.py` в разных терминалах.

3.  **Тестирование:** Попытайтесь отправить зашифрованное сообщение от одного Директора другому, используя команду `.msg <pubkey> <message>`.

4.  **Отладка:**
    *   Проанализируйте вывод в консоли обоих Директоров. Ищите ошибки, связанные с подключением к WebSocket, шифрованием или отправкой событий.
    *   Проверьте, что оба клиента успешно подключаются к `p2p-daemon` на `ws://localhost:9090`.
    *   Проанализируйте функцию `handle_command` в `pa2ap/local_director.py`. Убедитесь, что объект `EncryptedDirectMessage` создается, шифруется и подписывается без ошибок.
    *   Убедитесь, что вызов `agent.publish(event)` отрабатывает корректно.

5.  **Отчет:**
    *   Если связь работает успешно, пожалуйста, подтвердите это.
    *   Если вы обнаружите ошибку, предоставьте детальный отчет с логами и предложите исправление в виде конкретного изменения в коде.

Успешное выполнение этой задачи позволит нам перейти к следующему этапу — тестам плагина AgentScope.
